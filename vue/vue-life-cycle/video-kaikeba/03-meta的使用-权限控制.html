<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>vue登录</title>
</head>

<body>
    <div id="app">
        <router-link to="/home">首页</router-link>
        <router-link to="/blog">博客</router-link>
        <router-link to="/login">登录</router-link>

        <!-- 用来缓存组件的状态 -->
        <keep-alive>
            <router-view></router-view>
        </keep-alive>
    </div>
</body>
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
<script>
    
    let Home = {
        template: `
            <div>
                <router-link :to="{name:'details', params:{details:'details'}}">我是首页内容</router-link>
                <router-view></router-view>
            </div>
        `,
        watch: {
            $route(to, from) {
                //这种监听只是适用于在当前组件内部的监听使用，不同于全局的监听守卫
                console.log(to, from)
            }
        },
    };
    let Details = {
        template: `
            <div>详情页~</div>
        `,

    };

    let Blog = {
        template: `
            <div @click="clickHandle">我是博客内容</div>
        `,
        methods: {
            clickHandle(e) {
                e.target.style.color = "red";

            },
        }
    };
    let Article = {
        template: `
            <div">文章~</div>
        `,
    }

    let Login = {
        data() {
            return {
                usename: "",
                password: "",
            }
        },
        template: `
            <div>
                <input type="text" v-modek="usename" />
                <input type="text" v-model="password" />
                <input type="button" value="登录" @click="clickLogin"/>
            </div>
        `,
        methods: {
            clickLogin() {
                var LoginData = {
                    "usename": this.usename,
                    "password": this.password,
                };
                localStorage.setItem("user", JSON.stringify(LoginData));
                //编程式路由
                this.$router.push({
                    name:"blog",
                });
            },
        },
    };



    const router = new VueRouter({
        routes: [{
                path: '/',
                redirect: "/home",
            },
            {
                path: "/home",
                name: "home",
                component: Home,
                children: [{
                    path: "/home/:details",
                    name: "details",
                    component: Details,
                }],
            },
            {
                path: "/blog",
                name: "blog",
                component: Blog,
                meta: {
                    auth: true,
                },
                children: [{
                    path: "/blog/article",
                    component: Article,
                }],
            },
            {
                path: "/login",
                name: "login",
                component: Login,
            }
        ],

    });

    router.beforeEach((to, from, next) => {
        let useInfo = JSON.parse(localStorage.getItem("user"));
        //用户点了博客链接，该用户需要登录
        if(to.meta.auth){
            if(useInfo){    
                next();
            }else{
                next({
                    path: "/login"
                });
            }
        }else{
            next();
        }
    });

    const vm = new Vue({
        el: "#app",
        router,
    });
</script>

</html>